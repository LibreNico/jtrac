<HTML><HEAD><META CONTENT="text/html; charset=ISO-8859-1" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE WIDTH="100%" CLASS="hdft" CELLSPACING="0"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Thu Nov 24 14:39:44 CET 2016)</TH></TR><TR><TD CLASS="nv">[<A HREF="../index-coverage.html">all classes</A>][<A HREF="8.html">info.jtrac.hibernate</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">HibernateJtracDao.java</SPAN>]</H2><TABLE WIDTH="100%" CELLSPACING="0"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>HibernateJtracDao.java</TD><TD CLASS="h">14%  (1/7)</TD><TD CLASS="h">22%  (17/77)</TD><TD CLASS="h">8%   (133/1700)</TD><TD CLASS="h">12%  (31.8/274)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE WIDTH="100%" CLASS="cn" CELLSPACING="0"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">HibernateJtracDao$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#0">HibernateJtracDao$1 (HibernateJtracDao): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">doInHibernate (Session): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3">HibernateJtracDao$2</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#3">HibernateJtracDao$2 (HibernateJtracDao, Field, ArrayList): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#5">compare (Item, Item): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#6">HibernateJtracDao$3</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#6">HibernateJtracDao$3 (HibernateJtracDao): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">doInHibernate (Session): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#9">HibernateJtracDao$4</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/56)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#9">HibernateJtracDao$4 (HibernateJtracDao, int, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#b">doInHibernate (Session): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/44)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#c">HibernateJtracDao$5</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#c">HibernateJtracDao$5 (HibernateJtracDao, long): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">doInHibernate (Session): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#f">HibernateJtracDao$6</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#f">HibernateJtracDao$6 (HibernateJtracDao, String, String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#11">doInHibernate (Session): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#12">HibernateJtracDao</A></TD><TD>100% (1/1)</TD><TD CLASS="h">26%  (17/65)</TD><TD CLASS="h">9%   (133/1497)</TD><TD CLASS="h">13%  (31.8/243)</TD></TR><TR><TD CLASS="f"><A HREF="#13">bulkUpdateDeleteItemsForSpace (Space): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/69)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">bulkUpdateDeleteSpaceRole (Space, String): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#15">bulkUpdateFieldToNull (Space, Field): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/74)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">bulkUpdateFieldToNullForValue (Space, Field, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/116)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#17">bulkUpdateRenameSpaceRole (Space, String, String): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">bulkUpdateStatusToOpen (Space, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/76)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#19">doInMemorySort (List, ItemSearch): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#9">findAllItems (int, int): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">findAllSpaces (): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">findAllStoredSearch (): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">findAllUsers (): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">findItemUsersByUser (User): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">findItems (ItemSearch): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/122)</TD><TD CLASS="h">0%   (0/23)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">findItems (long, String): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#21">findSpacesByPrefixCode (String): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">findSpacesNotAllocatedToUser (long): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#23">findSpacesWhereIdIn (List): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">findUserRolesForSpace (long): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#25">findUsersByEmail (String): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">findUsersForSpace (long): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#27">findUsersForSpaceSet (Collection): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#f">findUsersMatching (String, String): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#29">findUsersNotAllocatedToSpace (long): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">findUsersWhereIdIn (List): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">findUsersWithRoleForSpace (long, String): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">loadCountOfAllItems (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">loadCountOfHistoryInvolvingUser (User): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">loadCountOfRecordsHavingFieldNotNull (Space, Field): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">loadCountOfRecordsHavingFieldWithValue (Space, Field, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/66)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">loadCountOfRecordsHavingStatus (Space, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#31">loadCountsForUser (User): CountsHolder</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/106)</TD><TD CLASS="h">0%   (0/20)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">loadCountsForUserSpace (User, Space): Counts</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/122)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR><TD CLASS="f"><A HREF="#33">loadHistory (long): History</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">loadItem (long): Item</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#c">loadNextSequenceNum (long): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">loadSpace (long): Space</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#37">loadStoredSearch (Long): StoredSearch</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">loadUser (long): User</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#39">removeItem (Item): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3a">removeItemItem (ItemItem): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">removeItemUser (ItemUser): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3c">removeSpace (Space): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3d">removeStoredSearch (StoredSearch): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3e">removeUser (User): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#3f">storeAttachment (Attachment): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#40">storeHistory (History): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#41">storeItem (Item): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#42">storeStoredSearch (StoredSearch): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#43">createSchema (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">22%  (39/177)</TD><TD CLASS="h">24%  (7.8/33)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">HibernateJtracDao (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#45">findAllConfig (): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#46">findSpaceRolesForUser (long): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#47">findSpacesWhereGuestAllowed (): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#48">findSuperUsers (): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#49">findUsersByLoginName (String): List</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4a">loadConfig (String): Config</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#4b">loadMetadata (long): Metadata</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4c">loadUserSpaceRole (long): UserSpaceRole</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (8/8)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#4d">removeUserSpaceRole (UserSpaceRole): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4e">setSchemaHelper (SchemaHelper): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#4f">storeConfig (Config): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#50">storeMetadata (Metadata): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#51">storeSpace (Space): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#52">storeSpaceSequence (SpaceSequence): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#53">storeUser (User): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (2/2)</TD></TR></TABLE><P></P><TABLE WIDTH="100%" CLASS="s" CELLSPACING="0"><TR><TD CLASS="l">1</TD><TD>/*</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright 2002-2005 the original author or authors.</TD></TR><TR><TD CLASS="l">3</TD><TD> *</TD></TR><TR><TD CLASS="l">4</TD><TD> * Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);</TD></TR><TR><TD CLASS="l">5</TD><TD> * you may not use this file except in compliance with the License.</TD></TR><TR><TD CLASS="l">6</TD><TD> * You may obtain a copy of the License at</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> *      http://www.apache.org/licenses/LICENSE-2.0</TD></TR><TR><TD CLASS="l">9</TD><TD> *</TD></TR><TR><TD CLASS="l">10</TD><TD> * Unless required by applicable law or agreed to in writing, software</TD></TR><TR><TD CLASS="l">11</TD><TD> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,</TD></TR><TR><TD CLASS="l">12</TD><TD> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</TD></TR><TR><TD CLASS="l">13</TD><TD> * See the License for the specific language governing permissions and</TD></TR><TR><TD CLASS="l">14</TD><TD> * limitations under the License.</TD></TR><TR><TD CLASS="l">15</TD><TD> */</TD></TR><TR><TD CLASS="l">16</TD><TD> </TD></TR><TR><TD CLASS="l">17</TD><TD>package info.jtrac.hibernate;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>import info.jtrac.JtracDao;</TD></TR><TR><TD CLASS="l">20</TD><TD>import info.jtrac.domain.*;</TD></TR><TR><TD CLASS="l">21</TD><TD> </TD></TR><TR><TD CLASS="l">22</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">23</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">24</TD><TD>import java.util.Collections;</TD></TR><TR><TD CLASS="l">25</TD><TD>import java.util.Comparator;</TD></TR><TR><TD CLASS="l">26</TD><TD>import java.util.HashMap;</TD></TR><TR><TD CLASS="l">27</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">28</TD><TD> </TD></TR><TR><TD CLASS="l">29</TD><TD>import java.util.Map;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.apache.commons.collections.ComparatorUtils;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.hibernate.CacheMode;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.hibernate.Criteria;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.hibernate.FetchMode;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.hibernate.Session;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.hibernate.criterion.DetachedCriteria;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.hibernate.criterion.MatchMode;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.hibernate.criterion.Order;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.hibernate.criterion.Projections;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.hibernate.criterion.Restrictions;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.springframework.orm.hibernate3.HibernateCallback;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.springframework.orm.hibernate3.HibernateTemplate;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.springframework.orm.hibernate3.support.HibernateDaoSupport;</TD></TR><TR><TD CLASS="l">43</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="12">44</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">45</TD><TD> * DAO Implementation using Spring Hibernate template</TD></TR><TR><TD CLASS="l">46</TD><TD> * note usage of the Spring &#34;init-method&#34; and &#34;destroy-method&#34; options</TD></TR><TR><TD CLASS="l">47</TD><TD> */</TD></TR><TR CLASS="c"><TD CLASS="l">48</TD><TD>public class HibernateJtracDao extends HibernateDaoSupport implements JtracDao {</TD></TR><TR><TD CLASS="l"><A NAME="4e">49</A></TD><TD>    </TD></TR><TR><TD CLASS="l">50</TD><TD>    private SchemaHelper schemaHelper;</TD></TR><TR><TD CLASS="l">51</TD><TD>    </TD></TR><TR><TD CLASS="l">52</TD><TD>    public void setSchemaHelper(SchemaHelper schemaHelper) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="41">53</A></TD><TD>        this.schemaHelper = schemaHelper;</TD></TR><TR CLASS="c"><TD CLASS="l">54</TD><TD>    }</TD></TR><TR><TD CLASS="l">55</TD><TD>    </TD></TR><TR><TD CLASS="l">56</TD><TD>    public void storeItem(Item item) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="34">57</A></TD><TD>        getHibernateTemplate().merge(item);</TD></TR><TR CLASS="z"><TD CLASS="l">58</TD><TD>    }</TD></TR><TR><TD CLASS="l">59</TD><TD>    </TD></TR><TR><TD CLASS="l">60</TD><TD>    public Item loadItem(long id) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="40">61</A></TD><TD>        return (Item) getHibernateTemplate().get(Item.class, id);</TD></TR><TR><TD CLASS="l">62</TD><TD>    }</TD></TR><TR><TD CLASS="l">63</TD><TD>    </TD></TR><TR><TD CLASS="l">64</TD><TD>    public void storeHistory(History history) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="33">65</A></TD><TD>        getHibernateTemplate().merge(history);</TD></TR><TR CLASS="z"><TD CLASS="l">66</TD><TD>    }    </TD></TR><TR><TD CLASS="l">67</TD><TD>    </TD></TR><TR><TD CLASS="l">68</TD><TD>    public History loadHistory(long id) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="20">69</A></TD><TD>        return (History) getHibernateTemplate().get(History.class, id);</TD></TR><TR><TD CLASS="l">70</TD><TD>    }</TD></TR><TR><TD CLASS="l">71</TD><TD>    </TD></TR><TR><TD CLASS="l">72</TD><TD>    public List&lt;Item&gt; findItems(long sequenceNum, String prefixCode) {</TD></TR><TR CLASS="z"><TD CLASS="l">73</TD><TD>        Object[] params = new Object[] {sequenceNum, prefixCode};</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1f">74</A></TD><TD>        return getHibernateTemplate().find(&#34;from Item item where item.sequenceNum = ? and item.space.prefixCode = ?&#34;, params);</TD></TR><TR><TD CLASS="l">75</TD><TD>    }</TD></TR><TR><TD CLASS="l">76</TD><TD>    </TD></TR><TR><TD CLASS="l">77</TD><TD>    public List&lt;Item&gt; findItems(ItemSearch itemSearch) {</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>        int pageSize = itemSearch.getPageSize();</TD></TR><TR><TD CLASS="l">79</TD><TD>        // TODO: if we are ordering by a custom column, we must load the whole</TD></TR><TR><TD CLASS="l">80</TD><TD>        // list to do an in-memory sort. we need to find a better way</TD></TR><TR CLASS="z"><TD CLASS="l">81</TD><TD>        Field.Name sortFieldName = Field.isValidName(itemSearch.getSortFieldName()) ? Field.convertToName(itemSearch.getSortFieldName()) : null;</TD></TR><TR><TD CLASS="l">82</TD><TD>        // only trigger the in-memory sort for drop-down fields and when querying within a space</TD></TR><TR><TD CLASS="l">83</TD><TD>        // UI currently does not allow you to sort by custom field when querying across spaces, but check again</TD></TR><TR CLASS="z"><TD CLASS="l">84</TD><TD>        boolean doInMemorySort = sortFieldName != null &amp;&amp; sortFieldName.isDropDownType() &amp;&amp; itemSearch.getSpace() != null;</TD></TR><TR CLASS="z"><TD CLASS="l">85</TD><TD>        if (pageSize == -1 || doInMemorySort) {</TD></TR><TR CLASS="z"><TD CLASS="l">86</TD><TD>            List&lt;Item&gt; list = getHibernateTemplate().findByCriteria(itemSearch.getCriteria());</TD></TR><TR CLASS="z"><TD CLASS="l">87</TD><TD>            if(!list.isEmpty() &amp;&amp; doInMemorySort) {</TD></TR><TR CLASS="z"><TD CLASS="l">88</TD><TD>                doInMemorySort(list, itemSearch);</TD></TR><TR><TD CLASS="l">89</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">90</TD><TD>            itemSearch.setResultCount(list.size());</TD></TR><TR CLASS="z"><TD CLASS="l">91</TD><TD>            if (pageSize != -1) {</TD></TR><TR><TD CLASS="l">92</TD><TD>                // order-by was requested on custom field, so we loaded all results, but only need one page</TD></TR><TR CLASS="z"><TD CLASS="l">93</TD><TD>                int start = pageSize * itemSearch.getCurrentPage();</TD></TR><TR CLASS="z"><TD CLASS="l">94</TD><TD>                int end = Math.min(start + itemSearch.getPageSize(), list.size());</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                return list.subList(start, end);</TD></TR><TR><TD CLASS="l">96</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="0">97</A></TD><TD>            return list;</TD></TR><TR><TD CLASS="l">98</TD><TD>        } else {</TD></TR><TR><TD CLASS="l"><A NAME="2">99</A></TD><TD>            // pagination</TD></TR><TR CLASS="z"><TD CLASS="l">100</TD><TD>            if(itemSearch.isBatchMode()) {</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>                getHibernateTemplate().execute(new HibernateCallback() {</TD></TR><TR><TD CLASS="l">102</TD><TD>                    public Object doInHibernate(Session session) {</TD></TR><TR CLASS="z"><TD CLASS="l">103</TD><TD>                        session.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">104</TD><TD>                        return null;</TD></TR><TR><TD CLASS="l">105</TD><TD>                    }                    </TD></TR><TR><TD CLASS="l">106</TD><TD>                });</TD></TR><TR><TD CLASS="l">107</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>            int firstResult = pageSize * itemSearch.getCurrentPage();</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>            List&lt;Item&gt; list = getHibernateTemplate().findByCriteria(itemSearch.getCriteria(), firstResult, pageSize);</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>            if(!itemSearch.isBatchMode()) {</TD></TR><TR CLASS="z"><TD CLASS="l">111</TD><TD>                DetachedCriteria criteria = itemSearch.getCriteriaForCount();</TD></TR><TR CLASS="z"><TD CLASS="l">112</TD><TD>                criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                Integer count = (Integer) getHibernateTemplate().findByCriteria(criteria).get(0);</TD></TR><TR CLASS="z"><TD CLASS="l">114</TD><TD>                itemSearch.setResultCount(count);</TD></TR><TR><TD CLASS="l">115</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">116</TD><TD>            return list;</TD></TR><TR><TD CLASS="l">117</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="19">118</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">119</TD><TD>    </TD></TR><TR><TD CLASS="l"><A NAME="3">120</A></TD><TD>    private void doInMemorySort(List&lt;Item&gt; list, ItemSearch itemSearch) { </TD></TR><TR><TD CLASS="l">121</TD><TD>        // we should never come here if search is across multiple spaces</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5">122</A></TD><TD>        final Field field = itemSearch.getSpace().getMetadata().getField(itemSearch.getSortFieldName());</TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>        final ArrayList&lt;String&gt; valueList = new ArrayList&lt;String&gt;(field.getOptions().keySet());</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>        Comparator&lt;Item&gt; comp = new Comparator&lt;Item&gt;() {</TD></TR><TR><TD CLASS="l">125</TD><TD>            public int compare(Item left, Item right) {</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                Object leftVal = left.getValue(field.getName());</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>                String leftValString = leftVal == null ? null : leftVal.toString();</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                int leftInd = valueList.indexOf(leftValString);</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>                Object rightVal = right.getValue(field.getName());</TD></TR><TR CLASS="z"><TD CLASS="l">130</TD><TD>                String rightValString = rightVal == null ? null : rightVal.toString();</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>                int rightInd = valueList.indexOf(rightValString);</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>                return leftInd - rightInd;</TD></TR><TR><TD CLASS="l">133</TD><TD>            }</TD></TR><TR><TD CLASS="l">134</TD><TD>        };</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="6">135</A></TD><TD>        Collections.sort(list, itemSearch.isSortDescending() ? ComparatorUtils.reversedComparator(comp) : comp);</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="8">137</A></TD><TD>    </TD></TR><TR><TD CLASS="l">138</TD><TD>    public int loadCountOfAllItems() {</TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>        return (Integer) getHibernateTemplate().execute(new HibernateCallback() {</TD></TR><TR><TD CLASS="l">140</TD><TD>            public Object doInHibernate(Session session) {</TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>                Criteria criteria = session.createCriteria(Item.class);</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>                criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                return criteria.list().get(0);</TD></TR><TR><TD CLASS="l">144</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="9">145</A></TD><TD>        });</TD></TR><TR><TD CLASS="l">146</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="b">147</A></TD><TD>    </TD></TR><TR><TD CLASS="l">148</TD><TD>    public List&lt;Item&gt; findAllItems(final int firstResult, final int batchSize) {</TD></TR><TR CLASS="z"><TD CLASS="l">149</TD><TD>        return getHibernateTemplate().executeFind(new HibernateCallback() {</TD></TR><TR><TD CLASS="l">150</TD><TD>            public Object doInHibernate(Session session) {</TD></TR><TR CLASS="z"><TD CLASS="l">151</TD><TD>                session.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>                Criteria criteria = session.createCriteria(Item.class);</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>                criteria.setCacheMode(CacheMode.IGNORE);</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                criteria.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);</TD></TR><TR CLASS="z"><TD CLASS="l">155</TD><TD>                criteria.setFetchMode(&#34;history&#34;, FetchMode.JOIN);</TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                criteria.add(Restrictions.ge(&#34;id&#34;, (long) firstResult));</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                criteria.add(Restrictions.lt(&#34;id&#34;, (long) firstResult + batchSize));</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                return criteria.list();</TD></TR><TR><TD CLASS="l">159</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="39">160</A></TD><TD>        });</TD></TR><TR><TD CLASS="l">161</TD><TD>    }</TD></TR><TR><TD CLASS="l">162</TD><TD>    </TD></TR><TR><TD CLASS="l">163</TD><TD>    public void removeItem(Item item) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3a">164</A></TD><TD>        getHibernateTemplate().delete(item);</TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>    }</TD></TR><TR><TD CLASS="l">166</TD><TD>    </TD></TR><TR><TD CLASS="l">167</TD><TD>    public void removeItemItem(ItemItem itemItem) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1e">168</A></TD><TD>        getHibernateTemplate().delete(itemItem);</TD></TR><TR CLASS="z"><TD CLASS="l">169</TD><TD>    }</TD></TR><TR><TD CLASS="l">170</TD><TD>    </TD></TR><TR><TD CLASS="l">171</TD><TD>    public List&lt;ItemUser&gt; findItemUsersByUser(User user) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3b">172</A></TD><TD>        return getHibernateTemplate().find(&#34;from ItemUser iu where iu.user = ?&#34;, user);</TD></TR><TR><TD CLASS="l">173</TD><TD>    }</TD></TR><TR><TD CLASS="l">174</TD><TD>    </TD></TR><TR><TD CLASS="l">175</TD><TD>    public void removeItemUser(ItemUser itemUser) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3f">176</A></TD><TD>        getHibernateTemplate().delete(itemUser);</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>    }</TD></TR><TR><TD CLASS="l">178</TD><TD>    </TD></TR><TR><TD CLASS="l">179</TD><TD>    public void storeAttachment(Attachment attachment) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="50">180</A></TD><TD>        getHibernateTemplate().merge(attachment);</TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>    }</TD></TR><TR><TD CLASS="l">182</TD><TD>    </TD></TR><TR><TD CLASS="l">183</TD><TD>    public void storeMetadata(Metadata metadata) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="4b">184</A></TD><TD>        getHibernateTemplate().merge(metadata);</TD></TR><TR CLASS="c"><TD CLASS="l">185</TD><TD>    }</TD></TR><TR><TD CLASS="l">186</TD><TD>    </TD></TR><TR><TD CLASS="l">187</TD><TD>    public Metadata loadMetadata(long id) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="51">188</A></TD><TD>        return (Metadata) getHibernateTemplate().get(Metadata.class, id);</TD></TR><TR><TD CLASS="l">189</TD><TD>    }</TD></TR><TR><TD CLASS="l">190</TD><TD>    </TD></TR><TR><TD CLASS="l">191</TD><TD>    public void storeSpace(Space space) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="36">192</A></TD><TD>        getHibernateTemplate().merge(space);</TD></TR><TR CLASS="c"><TD CLASS="l">193</TD><TD>    }</TD></TR><TR><TD CLASS="l">194</TD><TD>    </TD></TR><TR><TD CLASS="l">195</TD><TD>    public Space loadSpace(long id) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4c">196</A></TD><TD>        return (Space) getHibernateTemplate().get(Space.class, id);</TD></TR><TR><TD CLASS="l">197</TD><TD>    }</TD></TR><TR><TD CLASS="l">198</TD><TD>    </TD></TR><TR><TD CLASS="l">199</TD><TD>    public UserSpaceRole loadUserSpaceRole(long id) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="c">200</A></TD><TD>        return (UserSpaceRole) getHibernateTemplate().get(UserSpaceRole.class, id);</TD></TR><TR><TD CLASS="l">201</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="e">202</A></TD><TD>    </TD></TR><TR><TD CLASS="l">203</TD><TD>    public long loadNextSequenceNum(final long spaceSequenceId) {</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        return (Long) getHibernateTemplate().execute(new HibernateCallback() {</TD></TR><TR><TD CLASS="l">205</TD><TD>            public Object doInHibernate(Session session) {  </TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>                session.flush();</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>                session.setCacheMode(CacheMode.IGNORE);</TD></TR><TR CLASS="z"><TD CLASS="l">208</TD><TD>                SpaceSequence ss = (SpaceSequence) session.get(SpaceSequence.class, spaceSequenceId);</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>                long next = ss.getAndIncrement();</TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>                session.update(ss);</TD></TR><TR CLASS="z"><TD CLASS="l">211</TD><TD>                session.flush();</TD></TR><TR CLASS="z"><TD CLASS="l">212</TD><TD>                return next;</TD></TR><TR><TD CLASS="l">213</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="52">214</A></TD><TD>        });</TD></TR><TR><TD CLASS="l">215</TD><TD>    }</TD></TR><TR><TD CLASS="l">216</TD><TD>    </TD></TR><TR><TD CLASS="l">217</TD><TD>    public void storeSpaceSequence(SpaceSequence spaceSequence) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="21">218</A></TD><TD>        getHibernateTemplate().save(spaceSequence);</TD></TR><TR CLASS="c"><TD CLASS="l">219</TD><TD>    }</TD></TR><TR><TD CLASS="l">220</TD><TD>    </TD></TR><TR><TD CLASS="l">221</TD><TD>    public List&lt;Space&gt; findSpacesByPrefixCode(String prefixCode) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1b">222</A></TD><TD>        return getHibernateTemplate().find(&#34;from Space space where space.prefixCode = ?&#34;, prefixCode);</TD></TR><TR><TD CLASS="l">223</TD><TD>    }</TD></TR><TR><TD CLASS="l">224</TD><TD>    </TD></TR><TR><TD CLASS="l">225</TD><TD>    public List&lt;Space&gt; findAllSpaces() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="22">226</A></TD><TD>        return getHibernateTemplate().find(&#34;from Space space order by space.prefixCode&#34;);</TD></TR><TR><TD CLASS="l">227</TD><TD>    }</TD></TR><TR><TD CLASS="l">228</TD><TD>    </TD></TR><TR><TD CLASS="l">229</TD><TD>    public List&lt;Space&gt; findSpacesNotAllocatedToUser(long userId) {</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>        return getHibernateTemplate().find(&#34;from Space space where space not in&#34;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">231</A></TD><TD>                + &#34; (select usr.space from UserSpaceRole usr where usr.user.id = ?) order by space.name&#34;, userId);</TD></TR><TR><TD CLASS="l">232</TD><TD>    }</TD></TR><TR><TD CLASS="l">233</TD><TD>    </TD></TR><TR><TD CLASS="l">234</TD><TD>    public List&lt;Space&gt; findSpacesWhereIdIn(List&lt;Long&gt; ids) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="47">235</A></TD><TD>        return getHibernateTemplate().findByNamedParam(&#34;from Space space where space.id in (:ids)&#34;, &#34;ids&#34;, ids);</TD></TR><TR><TD CLASS="l">236</TD><TD>    }    </TD></TR><TR><TD CLASS="l">237</TD><TD>    </TD></TR><TR><TD CLASS="l">238</TD><TD>    public List&lt;Space&gt; findSpacesWhereGuestAllowed() {        </TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="3c">239</A></TD><TD>        return getHibernateTemplate().find(&#34;from Space space join fetch space.metadata where space.guestAllowed = true&#34;);</TD></TR><TR><TD CLASS="l">240</TD><TD>    }</TD></TR><TR><TD CLASS="l">241</TD><TD>    </TD></TR><TR><TD CLASS="l">242</TD><TD>    public void removeSpace(Space space) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="53">243</A></TD><TD>        getHibernateTemplate().delete(space);</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>    }</TD></TR><TR><TD CLASS="l">245</TD><TD>    </TD></TR><TR><TD CLASS="l">246</TD><TD>    public void storeUser(User user) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="38">247</A></TD><TD>        getHibernateTemplate().merge(user);</TD></TR><TR CLASS="c"><TD CLASS="l">248</TD><TD>    }</TD></TR><TR><TD CLASS="l">249</TD><TD>    </TD></TR><TR><TD CLASS="l">250</TD><TD>    public User loadUser(long id) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3e">251</A></TD><TD>        return (User) getHibernateTemplate().get(User.class, id);</TD></TR><TR><TD CLASS="l">252</TD><TD>    }</TD></TR><TR><TD CLASS="l">253</TD><TD>    </TD></TR><TR><TD CLASS="l">254</TD><TD>    public void removeUser(User user) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1d">255</A></TD><TD>        getHibernateTemplate().delete(user);</TD></TR><TR CLASS="z"><TD CLASS="l">256</TD><TD>    }</TD></TR><TR><TD CLASS="l">257</TD><TD>    </TD></TR><TR><TD CLASS="l">258</TD><TD>    public List&lt;User&gt; findAllUsers() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2a">259</A></TD><TD>        return getHibernateTemplate().find(&#34;from User user order by user.name&#34;);</TD></TR><TR><TD CLASS="l">260</TD><TD>    }</TD></TR><TR><TD CLASS="l">261</TD><TD>    </TD></TR><TR><TD CLASS="l">262</TD><TD>    public List&lt;User&gt; findUsersWhereIdIn(List&lt;Long&gt; ids) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="f">263</A></TD><TD>        return getHibernateTemplate().findByNamedParam(&#34;from User user where user.id in (:ids)&#34;, &#34;ids&#34;, ids);</TD></TR><TR><TD CLASS="l">264</TD><TD>    }    </TD></TR><TR><TD CLASS="l"><A NAME="11">265</A></TD><TD>    </TD></TR><TR><TD CLASS="l">266</TD><TD>    public List&lt;User&gt; findUsersMatching(final String searchText, final String searchOn) {</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>        return (List&lt;User&gt;) getHibernateTemplate().execute(new HibernateCallback() {</TD></TR><TR><TD CLASS="l">268</TD><TD>            public Object doInHibernate(Session session) {</TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                Criteria criteria = session.createCriteria(User.class);</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>                criteria.add(Restrictions.ilike(searchOn, searchText, MatchMode.ANYWHERE));</TD></TR><TR CLASS="z"><TD CLASS="l">271</TD><TD>                criteria.addOrder(Order.asc(&#34;name&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>                return criteria.list();</TD></TR><TR><TD CLASS="l">273</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="49">274</A></TD><TD>        });</TD></TR><TR><TD CLASS="l">275</TD><TD>    }</TD></TR><TR><TD CLASS="l">276</TD><TD>    </TD></TR><TR><TD CLASS="l">277</TD><TD>    public List&lt;User&gt; findUsersByLoginName(String loginName) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="25">278</A></TD><TD>        return getHibernateTemplate().find(&#34;from User user where user.loginName = ?&#34;, loginName);</TD></TR><TR><TD CLASS="l">279</TD><TD>    }</TD></TR><TR><TD CLASS="l">280</TD><TD>    </TD></TR><TR><TD CLASS="l">281</TD><TD>    public List&lt;User&gt; findUsersByEmail(String email) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="29">282</A></TD><TD>        return getHibernateTemplate().find(&#34;from User user where user.email = ?&#34;, email);</TD></TR><TR><TD CLASS="l">283</TD><TD>    }</TD></TR><TR><TD CLASS="l">284</TD><TD>    </TD></TR><TR><TD CLASS="l">285</TD><TD>    public List&lt;User&gt; findUsersNotAllocatedToSpace(long spaceId) {</TD></TR><TR CLASS="z"><TD CLASS="l">286</TD><TD>        return getHibernateTemplate().find(&#34;from User user where user not in&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">287</TD><TD>                + &#34; (select usr.user from UserSpaceRole usr where usr.space.id = ?) order by user.name&#34;, spaceId);</TD></TR><TR><TD CLASS="l"><A NAME="24">288</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">289</TD><TD>    </TD></TR><TR><TD CLASS="l">290</TD><TD>    public List&lt;UserSpaceRole&gt; findUserRolesForSpace(long spaceId) {</TD></TR><TR><TD CLASS="l">291</TD><TD>        // join fetch for user object</TD></TR><TR CLASS="z"><TD CLASS="l">292</TD><TD>        return getHibernateTemplate().find(&#34;select usr from UserSpaceRole usr join fetch usr.user&#34;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2b">293</A></TD><TD>                 + &#34; where usr.space.id = ? order by usr.user.name&#34;, spaceId);</TD></TR><TR><TD CLASS="l">294</TD><TD>    }</TD></TR><TR><TD CLASS="l">295</TD><TD>    </TD></TR><TR><TD CLASS="l">296</TD><TD>    public List&lt;User&gt; findUsersWithRoleForSpace(long spaceId, String roleKey) {</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>        return getHibernateTemplate().find(&#34;from User user&#34;</TD></TR><TR><TD CLASS="l">298</TD><TD>                + &#34; join user.userSpaceRoles as usr where usr.space.id = ?&#34;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="46">299</A></TD><TD>                + &#34; and usr.roleKey = ? order by user.name&#34;, new Object[] {spaceId, roleKey});</TD></TR><TR><TD CLASS="l">300</TD><TD>    }    </TD></TR><TR><TD CLASS="l">301</TD><TD>    </TD></TR><TR><TD CLASS="l">302</TD><TD>    public List&lt;UserSpaceRole&gt; findSpaceRolesForUser(long userId) {</TD></TR><TR CLASS="c"><TD CLASS="l">303</TD><TD>        return getHibernateTemplate().find(&#34;select usr from UserSpaceRole usr&#34;</TD></TR><TR><TD CLASS="l">304</TD><TD>                + &#34; left join fetch usr.space as space&#34;</TD></TR><TR><TD CLASS="l">305</TD><TD>                + &#34; left join fetch space.metadata&#34;</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="48">306</A></TD><TD>                + &#34; where usr.user.id = ? order by usr.space.name&#34;, userId);</TD></TR><TR><TD CLASS="l">307</TD><TD>    }</TD></TR><TR><TD CLASS="l">308</TD><TD>    </TD></TR><TR><TD CLASS="l">309</TD><TD>    public List&lt;User&gt; findSuperUsers() {</TD></TR><TR CLASS="c"><TD CLASS="l">310</TD><TD>        return getHibernateTemplate().find(&#34;select usr.user from UserSpaceRole usr&#34;</TD></TR><TR><TD CLASS="l"><A NAME="2d">311</A></TD><TD>                + &#34; where usr.space is null and usr.roleKey = ?&#34;, Role.ROLE_ADMIN);</TD></TR><TR><TD CLASS="l">312</TD><TD>    }</TD></TR><TR><TD CLASS="l">313</TD><TD>    </TD></TR><TR><TD CLASS="l">314</TD><TD>    public int loadCountOfHistoryInvolvingUser(User user) {</TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>        Long count = (Long) getHibernateTemplate().find(&#34;select count(history) from History history where &#34;</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>                + &#34; history.loggedBy = ? or history.assignedTo = ?&#34;, new Object[] {user, user}).get(0);</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>        return count.intValue();</TD></TR><TR><TD CLASS="l">318</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="31">319</A></TD><TD>    </TD></TR><TR><TD CLASS="l">320</TD><TD>    //==========================================================================</TD></TR><TR><TD CLASS="l">321</TD><TD>    </TD></TR><TR><TD CLASS="l">322</TD><TD>    public CountsHolder loadCountsForUser(User user) {</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>        Collection&lt;Space&gt; spaces = user.getSpaces();</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>        if (spaces.size() == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">325</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">326</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>        CountsHolder ch = new CountsHolder();</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>        HibernateTemplate ht = getHibernateTemplate();</TD></TR><TR CLASS="z"><TD CLASS="l">329</TD><TD>        List&lt;Object[]&gt; loggedByList = ht.find(&#34;select item.space.id, count(item) from Item item&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                + &#34; where item.loggedBy.id = ? group by item.space.id&#34;, user.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>        List&lt;Object[]&gt; assignedToList = ht.find(&#34;select item.space.id, count(item) from Item item&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                + &#34; where item.assignedTo.id = ? group by item.space.id&#34;, user.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">333</TD><TD>        List&lt;Object[]&gt; statusList = ht.findByNamedParam(&#34;select item.space.id, count(item) from Item item&#34; </TD></TR><TR><TD CLASS="l">334</TD><TD>                + &#34; where item.space in (:spaces) group by item.space.id&#34;, &#34;spaces&#34;, spaces);</TD></TR><TR CLASS="z"><TD CLASS="l">335</TD><TD>        for(Object[] oa : loggedByList) {</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>            ch.addLoggedByMe((Long) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">338</TD><TD>        for(Object[] oa : assignedToList) {</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>            ch.addAssignedToMe((Long) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">340</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>        for(Object[] oa : statusList) {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>            ch.addTotal((Long) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">343</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="32">344</A></TD><TD>        return ch;</TD></TR><TR><TD CLASS="l">345</TD><TD>    }</TD></TR><TR><TD CLASS="l">346</TD><TD>    </TD></TR><TR><TD CLASS="l">347</TD><TD>    public Counts loadCountsForUserSpace(User user, Space space) {</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>        HibernateTemplate ht = getHibernateTemplate();</TD></TR><TR CLASS="z"><TD CLASS="l">349</TD><TD>        List&lt;Object[]&gt; loggedByList = ht.find(&#34;select status, count(item) from Item item&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                + &#34; where item.loggedBy.id = ? and item.space.id = ? group by item.status&#34;, new Object[] {user.getId(), space.getId()});</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>        List&lt;Object[]&gt; assignedToList = ht.find(&#34;select status, count(item) from Item item&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                + &#34; where item.assignedTo.id = ? and item.space.id = ? group by item.status&#34;, new Object[] {user.getId(), space.getId()});</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>        List&lt;Object[]&gt; statusList = ht.find(&#34;select status, count(item) from Item item&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">354</TD><TD>                + &#34; where item.space.id = ? group by item.status&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">355</TD><TD>        Counts c = new Counts(true);</TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>        for(Object[] oa : loggedByList) {</TD></TR><TR CLASS="z"><TD CLASS="l">357</TD><TD>            c.addLoggedByMe((Integer) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">358</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>        for(Object[] oa : assignedToList) {</TD></TR><TR CLASS="z"><TD CLASS="l">360</TD><TD>            c.addAssignedToMe((Integer) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>        for(Object[] oa : statusList) {</TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>            c.addTotal((Integer) oa[0], (Long) oa[1]);</TD></TR><TR CLASS="z"><TD CLASS="l">364</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">365</TD><TD>        return c;</TD></TR><TR><TD CLASS="l">366</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="26">367</A></TD><TD>    </TD></TR><TR><TD CLASS="l">368</TD><TD>    //==========================================================================</TD></TR><TR><TD CLASS="l">369</TD><TD>    </TD></TR><TR><TD CLASS="l">370</TD><TD>    public List&lt;User&gt; findUsersForSpace(long spaceId) {</TD></TR><TR CLASS="z"><TD CLASS="l">371</TD><TD>        return getHibernateTemplate().find(&#34;select distinct u from User u join u.userSpaceRoles usr&#34;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="27">372</A></TD><TD>                + &#34; where usr.space.id = ? order by u.name&#34;, spaceId);</TD></TR><TR><TD CLASS="l">373</TD><TD>    }</TD></TR><TR><TD CLASS="l">374</TD><TD>    </TD></TR><TR><TD CLASS="l">375</TD><TD>    public List&lt;User&gt; findUsersForSpaceSet(Collection&lt;Space&gt; spaces) {</TD></TR><TR CLASS="z"><TD CLASS="l">376</TD><TD>        return getHibernateTemplate().findByNamedParam(&#34;select u from User u join u.userSpaceRoles usr&#34;</TD></TR><TR><TD CLASS="l"><A NAME="4d">377</A></TD><TD>                + &#34; where usr.space in (:spaces) order by u.name&#34;, &#34;spaces&#34;, spaces);</TD></TR><TR><TD CLASS="l">378</TD><TD>    }</TD></TR><TR><TD CLASS="l">379</TD><TD> </TD></TR><TR><TD CLASS="l">380</TD><TD>    public void removeUserSpaceRole(UserSpaceRole userSpaceRole) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="45">381</A></TD><TD>        getHibernateTemplate().delete(userSpaceRole);</TD></TR><TR CLASS="c"><TD CLASS="l">382</TD><TD>    }</TD></TR><TR><TD CLASS="l">383</TD><TD> </TD></TR><TR><TD CLASS="l">384</TD><TD>    public List&lt;Config&gt; findAllConfig() {</TD></TR><TR CLASS="c"><TD CLASS="l">385</TD><TD>        return getHibernateTemplate().loadAll(Config.class);</TD></TR><TR><TD CLASS="l"><A NAME="1c">386</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">387</TD><TD> </TD></TR><TR><TD CLASS="l">388</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">389</TD><TD>    public List&lt;StoredSearch&gt; findAllStoredSearch() {</TD></TR><TR CLASS="z"><TD CLASS="l">390</TD><TD>        return getHibernateTemplate().loadAll(StoredSearch.class);</TD></TR><TR><TD CLASS="l"><A NAME="4f">391</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">392</TD><TD> </TD></TR><TR><TD CLASS="l">393</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">394</TD><TD>    public void storeConfig(Config config) {</TD></TR><TR CLASS="c"><TD CLASS="l">395</TD><TD>        getHibernateTemplate().merge(config);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="42">396</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">397</TD><TD> </TD></TR><TR><TD CLASS="l">398</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">399</TD><TD>    public void storeStoredSearch(StoredSearch storedSearch) {</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>        getHibernateTemplate().merge(storedSearch);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="37">401</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">402</TD><TD> </TD></TR><TR><TD CLASS="l">403</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">404</TD><TD>    public StoredSearch loadStoredSearch(Long id) {</TD></TR><TR CLASS="z"><TD CLASS="l">405</TD><TD>        return (StoredSearch) getHibernateTemplate().get(StoredSearch.class, id);</TD></TR><TR><TD CLASS="l">406</TD><TD>    }</TD></TR><TR><TD CLASS="l"><A NAME="3d">407</A></TD><TD> </TD></TR><TR><TD CLASS="l">408</TD><TD> </TD></TR><TR><TD CLASS="l">409</TD><TD>    @Override</TD></TR><TR><TD CLASS="l">410</TD><TD>    public void removeStoredSearch(StoredSearch storedSearchToDel) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4a">411</A></TD><TD>            getHibernateTemplate().delete(storedSearchToDel);</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>    }</TD></TR><TR><TD CLASS="l">413</TD><TD> </TD></TR><TR><TD CLASS="l">414</TD><TD>    public Config loadConfig(String param) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2e">415</A></TD><TD>        return (Config) getHibernateTemplate().get(Config.class, param);</TD></TR><TR><TD CLASS="l">416</TD><TD>    }</TD></TR><TR><TD CLASS="l">417</TD><TD>    </TD></TR><TR><TD CLASS="l">418</TD><TD>    public int loadCountOfRecordsHavingFieldNotNull(Space space, Field field) {</TD></TR><TR CLASS="z"><TD CLASS="l">419</TD><TD>        Criteria criteria = getSession().createCriteria(Item.class);</TD></TR><TR CLASS="z"><TD CLASS="l">420</TD><TD>        criteria.add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>        criteria.add(Restrictions.isNotNull(field.getName().toString()));</TD></TR><TR CLASS="z"><TD CLASS="l">422</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l">423</TD><TD>        int itemCount = (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">424</TD><TD>        // even when no item has this field not null currently, items may have history with this field not null</TD></TR><TR><TD CLASS="l">425</TD><TD>        // because of the &#34;parent&#34; difference, cannot use AbstractItem and have to do a separate Criteria query</TD></TR><TR CLASS="z"><TD CLASS="l">426</TD><TD>        criteria = getSession().createCriteria(History.class);</TD></TR><TR CLASS="z"><TD CLASS="l">427</TD><TD>        criteria.createCriteria(&#34;parent&#34;).add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">428</TD><TD>        criteria.add(Restrictions.isNotNull(field.getName().toString()));</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="15">430</A></TD><TD>        return itemCount + (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">431</TD><TD>    }</TD></TR><TR><TD CLASS="l">432</TD><TD>    </TD></TR><TR><TD CLASS="l">433</TD><TD>    public int bulkUpdateFieldToNull(Space space, Field field) {</TD></TR><TR CLASS="z"><TD CLASS="l">434</TD><TD>        int itemCount = getHibernateTemplate().bulkUpdate(&#34;update Item item set item.&#34; + field.getName() + &#34; = null&#34; </TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                + &#34; where item.space.id = ?&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>        logger.info(&#34;no of Item rows where &#34; + field.getName() + &#34; set to null = &#34; + itemCount);</TD></TR><TR CLASS="z"><TD CLASS="l">437</TD><TD>        int historyCount = getHibernateTemplate().bulkUpdate(&#34;update History history set history.&#34; + field.getName() + &#34; = null&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">438</TD><TD>                + &#34; where history.parent in ( from Item item where item.space.id = ? )&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">439</TD><TD>        logger.info(&#34;no of History rows where &#34; + field.getName() + &#34; set to null = &#34; + historyCount);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2f">440</A></TD><TD>        return itemCount;</TD></TR><TR><TD CLASS="l">441</TD><TD>    }</TD></TR><TR><TD CLASS="l">442</TD><TD>    </TD></TR><TR><TD CLASS="l">443</TD><TD>    public int loadCountOfRecordsHavingFieldWithValue(Space space, Field field, int optionKey) {</TD></TR><TR CLASS="z"><TD CLASS="l">444</TD><TD>        Criteria criteria = getSession().createCriteria(Item.class);</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>        criteria.add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>        criteria.add(Restrictions.eq(field.getName().toString(), optionKey));</TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l">448</TD><TD>        int itemCount = (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">449</TD><TD>        // even when no item has this field value currently, items may have history with this field value</TD></TR><TR><TD CLASS="l">450</TD><TD>        // because of the &#34;parent&#34; difference, cannot use AbstractItem and have to do a separate Criteria query</TD></TR><TR CLASS="z"><TD CLASS="l">451</TD><TD>        criteria = getSession().createCriteria(History.class);</TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>        criteria.createCriteria(&#34;parent&#34;).add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>        criteria.add(Restrictions.eq(field.getName().toString(), optionKey));</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="16">455</A></TD><TD>        return itemCount + (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">456</TD><TD>    }</TD></TR><TR><TD CLASS="l">457</TD><TD>    </TD></TR><TR><TD CLASS="l">458</TD><TD>    public int bulkUpdateFieldToNullForValue(Space space, Field field, int optionKey) {</TD></TR><TR CLASS="z"><TD CLASS="l">459</TD><TD>        int itemCount = getHibernateTemplate().bulkUpdate(&#34;update Item item set item.&#34; + field.getName() + &#34; = null&#34; </TD></TR><TR><TD CLASS="l">460</TD><TD>                + &#34; where item.space.id = ?&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>                + &#34; and item.&#34; + field.getName() + &#34; = ?&#34;, new Object[] {space.getId(), optionKey});</TD></TR><TR CLASS="z"><TD CLASS="l">462</TD><TD>        logger.info(&#34;no of Item rows where &#34; + field.getName() + &#34; value '&#34; + optionKey + &#34;' replaced with null = &#34; + itemCount);</TD></TR><TR CLASS="z"><TD CLASS="l">463</TD><TD>        int historyCount = getHibernateTemplate().bulkUpdate(&#34;update History history set history.&#34; + field.getName() + &#34; = null&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">464</TD><TD>                + &#34; where history.&#34; + field.getName() + &#34; = ?&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">465</TD><TD>                + &#34; and history.parent in ( from Item item where item.space.id = ? )&#34;, new Object[] {optionKey, space.getId()});</TD></TR><TR CLASS="z"><TD CLASS="l">466</TD><TD>        logger.info(&#34;no of History rows where &#34; + field.getName() + &#34; value '&#34; + optionKey + &#34;' replaced with null = &#34; + historyCount);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="30">467</A></TD><TD>        return itemCount;</TD></TR><TR><TD CLASS="l">468</TD><TD>    }</TD></TR><TR><TD CLASS="l">469</TD><TD>    </TD></TR><TR><TD CLASS="l">470</TD><TD>    public int loadCountOfRecordsHavingStatus(Space space, int status) {</TD></TR><TR CLASS="z"><TD CLASS="l">471</TD><TD>        Criteria criteria = getSession().createCriteria(Item.class);</TD></TR><TR CLASS="z"><TD CLASS="l">472</TD><TD>        criteria.add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>        criteria.add(Restrictions.eq(&#34;status&#34;, status));</TD></TR><TR CLASS="z"><TD CLASS="l">474</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l">475</TD><TD>        int itemCount = (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">476</TD><TD>        // even when no item has this status currently, items may have history with this status</TD></TR><TR><TD CLASS="l">477</TD><TD>        // because of the &#34;parent&#34; difference, cannot use AbstractItem and have to do a separate Criteria query</TD></TR><TR CLASS="z"><TD CLASS="l">478</TD><TD>        criteria = getSession().createCriteria(History.class);</TD></TR><TR CLASS="z"><TD CLASS="l">479</TD><TD>        criteria.createCriteria(&#34;parent&#34;).add(Restrictions.eq(&#34;space&#34;, space));</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>        criteria.add(Restrictions.eq(&#34;status&#34;, status));</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>        criteria.setProjection(Projections.rowCount());</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="18">482</A></TD><TD>        return itemCount + (Integer) criteria.list().get(0);</TD></TR><TR><TD CLASS="l">483</TD><TD>    }</TD></TR><TR><TD CLASS="l">484</TD><TD>    </TD></TR><TR><TD CLASS="l">485</TD><TD>    public int bulkUpdateStatusToOpen(Space space, int status) {</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>        int itemCount = getHibernateTemplate().bulkUpdate(&#34;update Item item set item.status = &#34; + State.OPEN </TD></TR><TR CLASS="z"><TD CLASS="l">487</TD><TD>                + &#34; where item.status = ? and item.space.id = ?&#34;, new Object[] {status, space.getId()});</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>        logger.info(&#34;no of Item rows where status changed from &#34; + status + &#34; to &#34; + State.OPEN + &#34; = &#34; + itemCount);</TD></TR><TR CLASS="z"><TD CLASS="l">489</TD><TD>        int historyCount = getHibernateTemplate().bulkUpdate(&#34;update History history set history.status = &#34; + State.OPEN </TD></TR><TR><TD CLASS="l">490</TD><TD>                + &#34; where history.status = ?&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                + &#34; and history.parent in ( from Item item where item.space.id = ? )&#34;, new Object[] {status, space.getId()});</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>        logger.info(&#34;no of History rows where status changed from &#34; + status + &#34; to &#34; + State.OPEN + &#34; = &#34; + historyCount);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="17">493</A></TD><TD>        return itemCount;</TD></TR><TR><TD CLASS="l">494</TD><TD>    }</TD></TR><TR><TD CLASS="l">495</TD><TD>    </TD></TR><TR><TD CLASS="l">496</TD><TD>    public int bulkUpdateRenameSpaceRole(Space space, String oldRoleKey, String newRoleKey) {</TD></TR><TR CLASS="z"><TD CLASS="l">497</TD><TD>        return getHibernateTemplate().bulkUpdate(&#34;update UserSpaceRole usr set usr.roleKey = ?&#34;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="14">498</A></TD><TD>                + &#34; where usr.roleKey = ? and usr.space.id = ?&#34;, new Object[] {newRoleKey, oldRoleKey, space.getId()});</TD></TR><TR><TD CLASS="l">499</TD><TD>    }</TD></TR><TR><TD CLASS="l">500</TD><TD>    </TD></TR><TR><TD CLASS="l">501</TD><TD>    public int bulkUpdateDeleteSpaceRole(Space space, String roleKey) {</TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>        if (roleKey == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>            return getHibernateTemplate().bulkUpdate(&#34;delete UserSpaceRole usr where usr.space.id = ?&#34;, space.getId());</TD></TR><TR><TD CLASS="l">504</TD><TD>        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">505</TD><TD>            return getHibernateTemplate().bulkUpdate(&#34;delete UserSpaceRole usr&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">506</TD><TD>                    + &#34; where usr.space.id = ? and usr.roleKey = ?&#34;, new Object[] {space.getId(), roleKey});</TD></TR><TR><TD CLASS="l"><A NAME="13">507</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">508</TD><TD>    }</TD></TR><TR><TD CLASS="l">509</TD><TD>    </TD></TR><TR><TD CLASS="l">510</TD><TD>    public int bulkUpdateDeleteItemsForSpace(Space space) {</TD></TR><TR CLASS="z"><TD CLASS="l">511</TD><TD>        int historyCount = getHibernateTemplate().bulkUpdate(&#34;delete History history where history.parent in&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>                + &#34; ( from Item item where item.space.id = ? )&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">513</TD><TD>        logger.debug(&#34;deleted &#34; + historyCount + &#34; records from history&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">514</TD><TD>        int itemItemCount = getHibernateTemplate().bulkUpdate(&#34;delete ItemItem itemItem where itemItem.item in&#34;</TD></TR><TR CLASS="z"><TD CLASS="l">515</TD><TD>                + &#34; ( from Item item where item.space.id = ? )&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">516</TD><TD>        logger.debug(&#34;deleted &#34; + itemItemCount + &#34; records from item_items&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">517</TD><TD>        int itemCount = getHibernateTemplate().bulkUpdate(&#34;delete Item item where item.space.id = ?&#34;, space.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">518</TD><TD>        logger.debug(&#34;deleted &#34; + itemCount + &#34; records from items&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">519</TD><TD>        return historyCount + itemItemCount + itemCount;</TD></TR><TR><TD CLASS="l">520</TD><TD>    }</TD></TR><TR><TD CLASS="l">521</TD><TD>    </TD></TR><TR><TD CLASS="l">522</TD><TD>    //==========================================================================</TD></TR><TR><TD CLASS="l">523</TD><TD>    </TD></TR><TR><TD CLASS="l">524</TD><TD>    /**</TD></TR><TR><TD CLASS="l">525</TD><TD>     * note that this is automatically configured to run on startup </TD></TR><TR><TD CLASS="l"><A NAME="43">526</A></TD><TD>     * as a spring bean &#34;init-method&#34;</TD></TR><TR><TD CLASS="l">527</TD><TD>     */</TD></TR><TR><TD CLASS="l">528</TD><TD>    public void createSchema() {</TD></TR><TR><TD CLASS="l">529</TD><TD>        try {</TD></TR><TR CLASS="c"><TD CLASS="l">530</TD><TD>            getHibernateTemplate().find(&#34;from Item item where item.id = 1&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">531</TD><TD>            logger.info(&#34;database schema exists, normal startup&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">532</TD><TD>        } catch (Exception e) {</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>            logger.warn(&#34;expected database schema does not exist, will create. Error is: &#34; + e.getMessage());</TD></TR><TR CLASS="z"><TD CLASS="l">534</TD><TD>            schemaHelper.createSchema();</TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>            User admin = new User();</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>            admin.setLoginName(&#34;admin&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>            admin.setName(&#34;Admin&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">538</TD><TD>            admin.setEmail(&#34;admin&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>            admin.setPassword(&#34;21232f297a57a5a743894a0e4a801fc3&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>            admin.addSpaceWithRole(null, Role.ROLE_ADMIN);</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>            logger.info(&#34;inserting default admin user into database&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>            storeUser(admin);</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>            logger.info(&#34;schema creation complete&#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">544</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">545</TD><TD>        List&lt;SpaceSequence&gt; ssList = getHibernateTemplate().loadAll(SpaceSequence.class);</TD></TR><TR CLASS="c"><TD CLASS="l">546</TD><TD>        Map&lt;Long, SpaceSequence&gt; ssMap = new HashMap&lt;Long, SpaceSequence&gt;(ssList.size());</TD></TR><TR CLASS="p"><TD TITLE="59% line coverage (17 out of 29 instructions)" CLASS="l">547</TD><TD TITLE="59% line coverage (17 out of 29 instructions)">        for(SpaceSequence ss : ssList) {</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>            ssMap.put(ss.getId(), ss);</TD></TR><TR CLASS="z"><TD CLASS="l">549</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">550</TD><TD>        List&lt;Object[]&gt; list = getHibernateTemplate().find(&#34;select item.space.id, max(item.sequenceNum) from Item item group by item.space.id&#34;);</TD></TR><TR CLASS="p"><TD TITLE="20% line coverage (11 out of 56 instructions)" CLASS="l">551</TD><TD TITLE="20% line coverage (11 out of 56 instructions)">        for(Object[] oa : list) {</TD></TR><TR CLASS="z"><TD CLASS="l">552</TD><TD>            Long spaceId = (Long) oa[0];</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>            Long maxSeqNum = (Long) oa[1];</TD></TR><TR CLASS="z"><TD CLASS="l">554</TD><TD>            SpaceSequence ss = ssMap.get(spaceId);</TD></TR><TR CLASS="z"><TD CLASS="l">555</TD><TD>            logger.info(&#34;checking space sequence id: &#34; + spaceId + &#34;, max: &#34; + maxSeqNum + &#34;, next: &#34; + ss.getNextSeqNum());</TD></TR><TR CLASS="z"><TD CLASS="l">556</TD><TD>            if(ss.getNextSeqNum() &lt;= maxSeqNum) {</TD></TR><TR CLASS="z"><TD CLASS="l">557</TD><TD>                logger.warn(&#34;fixing sequence number for space id: &#34; + spaceId </TD></TR><TR CLASS="z"><TD CLASS="l">558</TD><TD>                        + &#34;, was: &#34; + ss.getNextSeqNum() + &#34;, should be: &#34; + (maxSeqNum + 1));</TD></TR><TR CLASS="z"><TD CLASS="l">559</TD><TD>                ss.setNextSeqNum(maxSeqNum + 1);</TD></TR><TR CLASS="z"><TD CLASS="l">560</TD><TD>                getHibernateTemplate().update(ss);</TD></TR><TR><TD CLASS="l">561</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">563</TD><TD>    }</TD></TR><TR><TD CLASS="l">564</TD><TD>    </TD></TR><TR><TD CLASS="l">565</TD><TD>}</TD></TR></TABLE><P></P><TABLE WIDTH="100%" CLASS="hdft" CELLSPACING="0"><TR><TD CLASS="nv">[<A HREF="../index-coverage.html">all classes</A>][<A HREF="8.html">info.jtrac.hibernate</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.0.5312</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>